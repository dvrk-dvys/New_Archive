tests:

  - name: contact-center-events-suite.jslt compiles
    type: compile
    expression: |
      import "checks/panda/contact-center-checks/contact-center-events-suite.jslt" as p
      p(.)

  - name: contact-center-events-suite.jslt generates metrics for a valid ad-contact events
    expected:
      - quality.check:
          tags:
            provider: sdrn:schibsted:client:leboncoin
            check-type: availability
            obj-type: ad-contact
            check-suite: panda.commons
            check-name: type_not_null
            check-result: 'true'
            check-impact: blocker
          delta: 1
      - quality.check:
          tags:
            provider: sdrn:schibsted:client:leboncoin
            check-type: availability
            obj-type: ad-contact
            check-suite: panda.commons
            check-name: version_not_null
            check-result: 'false'
            check-impact: blocker
          delta: 1
      - quality.check:
          tags:
            provider: sdrn:schibsted:client:leboncoin
            check-type: validity
            obj-type: ad-contact
            check-suite: panda.commons
            check-name: version_is_integer
            check-result: 'false'
            check-impact: blocker
          delta: 1
      - quality.check:
          tags:
            provider: sdrn:schibsted:client:leboncoin
            check-type: availability
            obj-type: ad-contact
            check-suite: panda.commons
            check-name: object_type_not_null
            check-result: 'true'
            check-impact: blocker
          delta: 1
      - quality.check:
          tags:
            provider: sdrn:schibsted:client:leboncoin
            check-type: availability
            obj-type: ad-contact
            check-suite: panda.commons
            check-name: object_ad_id_not_null
            check-result: 'true'
            check-impact: blocker
          delta: 1
      - quality.check:
          tags:
            provider: sdrn:schibsted:client:leboncoin
            check-type: validity
            obj-type: ad-contact
            check-suite: panda.commons
            check-name: object_ad_id_valid_format
            check-result: 'true'
            check-impact: blocker
          delta: 1
      - quality.check:
          tags:
            provider: sdrn:schibsted:client:leboncoin
            check-type: availability
            obj-type: ad-contact
            check-suite: panda.contact_center
            check-name: creation_date_not_null
            check-result: 'true'
            check-impact: blocker
          delta: 1
      - quality.check:
          tags:
            provider: sdrn:schibsted:client:leboncoin
            check-type: validity
            obj-type: ad-contact
            check-suite: panda.contact_center
            check-name: creation_date_valid_format
            check-result: 'true'
            check-impact: blocker
          delta: 1
      - quality.check:
          tags:
            provider: sdrn:schibsted:client:leboncoin
            check-type: availability
            obj-type: ad-contact
            check-suite: panda.contact_center
            check-name: initiator_id_not_null
            check-result: 'true'
            check-impact: blocker
          delta: 1
      - quality.check:
          tags:
            provider: sdrn:schibsted:client:leboncoin
            check-type: validity
            obj-type: ad-contact
            check-suite: panda.contact_center
            check-name: initiator_id_valid_format
            check-result: 'true'
            check-impact: blocker
          delta: 1
      - quality.check:
          tags:
            provider: sdrn:schibsted:client:leboncoin
            check-type: availability
            obj-type: ad-contact
            check-suite: panda.contact_center
            check-name: initiator_name_not_null
            check-result: 'true'
            check-impact: blocker
          delta: 1
      - quality.check:
          tags:
            provider: sdrn:schibsted:client:leboncoin
            check-type: availability
            obj-type: ad-contact
            check-suite: panda.contact_center
            check-name: initiator_email_not_null
            check-result: 'true'
            check-impact: blocker
          delta: 1
      - quality.check:
          tags:
            provider: sdrn:schibsted:client:leboncoin
            check-type: validity
            obj-type: ad-contact
            check-suite: panda.contact_center
            check-name: initiator_email_valid_format
            check-result: 'true'
            check-impact: blocker
          delta: 1
      - quality.check:
          tags:
            provider: sdrn:schibsted:client:leboncoin
            check-type: availability
            obj-type: ad-contact
            check-suite: panda.contact_center
            check-name: recipient_id_not_null
            check-result: 'true'
            check-impact: blocker
          delta: 1
      - quality.check:
          tags:
            provider: sdrn:schibsted:client:leboncoin
            check-type: validity
            obj-type: ad-contact
            check-suite: panda.contact_center
            check-name: recipient_id_valid_format
            check-result: 'true'
            check-impact: blocker
          delta: 1
      - quality.check:
          tags:
            provider: sdrn:schibsted:client:leboncoin
            check-type: validity
            obj-type: ad-contact
            check-suite: panda.contact_center
            check-name: ad_reply_type_valid_value
            check-result: 'true'
            check-impact: blocker
          delta: 1
      - quality.check:
          tags:
            provider: sdrn:schibsted:client:leboncoin
            check-type: availability
            obj-type: ad-contact
            check-suite: panda.contact_center
            check-name: is_moderated_not_null
            check-result: 'false'
            check-impact: blocker
          delta: 1
      - quality.check:
          tags:
            provider: sdrn:schibsted:client:leboncoin
            check-type: availability
            obj-type: ad-contact
            check-suite: panda.contact_center
            check-name: search_criteria_not_null
            check-result: 'true'
            check-impact: minor
          delta: 1
    expression: |
      import "checks/panda/contact-center-checks/contact-center-events-suite.jslt" as p
      let event =
      {
        "device": {
          "environmentId": "sdrn:schibsted:environment:00000000-0000-4000-8000-000000000000",
          "isBot": false
        },
        "object": {
          "@id": "sdrn:leboncoin:contact:ad212eb4-a8ec-11eb-85da-d6af66fd061d",
          "@type": "ContactForm",
          "inReplyTo": {
            "@id": "sdrn:leboncoin:classified:1946032547",
            "@type": "ClassifiedAd",
            "categories": [],
            "category": "",
            "contentId": "1946032547",
            "images": [],
            "items": [],
            "name": ""
          },
          "initiatorId": "sdrn:leboncoin:user:fcc0704e-76d4-43b4-84ed-191b5ae0bcfd",
          "initiatorName": "Sandrine MUTHUON",
          "initiatorEmail": "muthuons@gmail.com",
          "initiatorPhone": "0769946358",
          "recipientId": "sdrn:leboncoin:user:5384f791-7ccb-4309-a361-ab29301ebb29",
          "message": "Auriez vous d autres photo svp",
          "adReplyType": "email"
        },
        "provider": {
          "@id": "sdrn:schibsted:client:leboncoin",
          "@type": "",
          "productTag": "kaas-as-pulse"
        },
        "schema": "http://schema.schibsted.com/events/tracker-event.json/177.json#",
        "@id": "ad212eb4-a8ec-11eb-85da-d6af66fd061d",
        "@type": "Send",
        "creationDate": "2021-04-29T13:13:23Z",
        "published": "2021-04-29T13:13:23Z",
        "search": {
          "@id": "ad212eb4-a8ec-11eb-85da-d6af66fd061d",
          "@type": "SearchMetadata",
          "genericSearchFilters": [
            {
              "label": "search",
              "values": [
                "immeuble"
              ]
            },
            {
              "label": "category",
              "values": [
                "9"
              ]
            },
            {
              "label": "price",
              "minValue": 0,
              "maxValue": 550000
            },
            {
              "label": "location",
              "locations": [
                {
                  "@type": "PostalAddress",
                  "addressCountry": "FR",
                  "addressRegion": "Languedoc-Roussillon",
                  "addressSubarea": "11",
                  "addressLocality": "Narbonne",
                  "postalCode": "11100"
                }
              ]
            },
            {
              "label": "area",
              "minValue": 140,
              "maxValue": 0
            },
            {
              "label": "rooms",
              "minValue": 6,
              "maxValue": 0
            },
            {
              "label": "realEstateTypes",
              "values": [
                "Autre"
              ]
            }
          ]
        },
        "tracker": {
          "type": "Custom",
          "version": ""
        },
        "deployStage": "pro",
        "collectorHost": "collector.mpianalytics.com"
      }
      p($event)
