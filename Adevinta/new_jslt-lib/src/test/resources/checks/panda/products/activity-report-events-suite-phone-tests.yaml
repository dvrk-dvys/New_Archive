tests:

    - name: activity-report-events-suite.jslt compiles
      type: compile
      expression: |
        import "checks/panda/products/activity-report-events-suite.jslt" as p
        p(.)
  
    - name: activity-report-events-suite.jslt generates metrics for a valid ad-phone events
      expected:
        - quality.check:
            tags:
              check-group: check-generic-fields
              check-type: availability
              provider: sdrn:schibsted:client:leboncoin
              obj-type: ad-phone-displayed
              check-suite: panda.products.activity_report
              check-name: domain_is_available
              check-result: 'true'
              check-impact: blocker
            delta: 1
        - quality.check:
            tags:
              check-group: check-generic-fields
              check-type: validity
              provider: sdrn:schibsted:client:leboncoin
              obj-type: ad-phone-displayed
              check-suite: panda.products.activity_report
              check-name: domain_is_valid
              check-result: 'true'
              check-impact: blocker
            delta: 1
        - quality.check:
            tags:
              check-group: check-generic-fields
              check-type: availability
              provider: sdrn:schibsted:client:leboncoin
              obj-type: ad-phone-displayed
              check-suite: panda.products.activity_report
              check-name: visitor_ip_available
              check-result: 'true'
              check-impact: blocker
            delta: 1
        - quality.check:
            tags:
              check-group: check-generic-fields
              check-type: validity
              provider: sdrn:schibsted:client:leboncoin
              obj-type: ad-phone-displayed
              check-suite: panda.products.activity_report
              check-name: visitor_ip_valid
              check-result: 'true'
              check-impact: blocker
            delta: 1
        - quality.check:
            tags:
              check-group: check-generic-fields
              check-type: availability
              provider: sdrn:schibsted:client:leboncoin
              obj-type: ad-phone-displayed
              check-suite: panda.products.activity_report
              check-name: creation_date_available
              check-result: 'true'
              check-impact: blocker
            delta: 1
        - quality.check:
            tags:
              check-group: check-generic-fields
              check-type: validity
              provider: sdrn:schibsted:client:leboncoin
              obj-type: ad-phone-displayed
              check-suite: panda.products.activity_report
              check-name: creation_date_valid
              check-result: 'true'
              check-impact: blocker
            delta: 1
        - quality.check:
            tags:
              check-group: check-contact-events
              check-type: availability
              provider: sdrn:schibsted:client:leboncoin
              obj-type: ad-phone-displayed
              check-suite: panda.products.activity_report
              check-name: contact_object_id_is_available
              check-result: 'true'
              check-impact: blocker
            delta: 1
        - quality.check:
            tags:
              check-group: check-contact-events
              check-type: validity
              provider: sdrn:schibsted:client:leboncoin
              obj-type: ad-phone-displayed
              check-suite: panda.products.activity_report
              check-name: contact_object_id_is_valid
              check-result: 'true'
              check-impact: blocker
            delta: 1
        - quality.check:
            tags:
              check-group: check-contact-events
              check-type: availability
              provider: sdrn:schibsted:client:leboncoin
              obj-type: ad-phone-displayed
              check-suite: panda.products.activity_report
              check-name: contact_publisher_is_available
              check-result: 'true'
              check-impact: blocker
            delta: 1
        - quality.check:
            tags:
              check-group: check-contact-events
              check-type: availability
              provider: sdrn:schibsted:client:leboncoin
              obj-type: ad-phone-displayed
              check-suite: panda.products.activity_report
              check-name: contact_publisher_id_is_available
              check-result: 'true'
              check-impact: blocker
            delta: 1
        - quality.check:
            tags:
              check-group: check-contact-events
              check-type: validity
              provider: sdrn:schibsted:client:leboncoin
              obj-type: ad-phone-displayed
              check-suite: panda.products.activity_report
              check-name: contact_publisher_id_is_valid
              check-result: 'true'
              check-impact: blocker
            delta: 1
        - quality.check:
            tags:
              check-group: check-contact-events
              check-type: availability
              provider: sdrn:schibsted:client:leboncoin
              obj-type: ad-phone-displayed
              check-suite: panda.products.activity_report
              check-name: contact_categories_are_available
              check-result: 'true'
              check-impact: blocker
            delta: 1
        - quality.check:
            tags:
              check-group: check-contact-events
              check-type: availability
              provider: sdrn:schibsted:client:leboncoin
              obj-type: ad-phone-displayed
              check-suite: panda.products.activity_report
              check-name: contact_categories_local_ids_available
              check-result: 'true'
              check-impact: blocker
            delta: 1
        - quality.check:
            tags:
              check-group: check-contact-events
              check-type: availability
              provider: sdrn:schibsted:client:leboncoin
              obj-type: ad-phone-displayed
              check-suite: panda.products.activity_report
              check-name: contact_categories_levels_are_available
              check-result: 'true'
              check-impact: blocker
            delta: 1
        - quality.check:
            tags:
              check-group: check-contact-events
              check-type: validity
              provider: sdrn:schibsted:client:leboncoin
              obj-type: ad-phone-displayed
              check-suite: panda.products.activity_report
              check-name: contact_categories_levels_are_valid
              check-result: 'false'
              check-impact: blocker
            delta: 1
        - quality.check:
            tags:
              check-group: check-contact-events
              check-type: availability
              provider: sdrn:schibsted:client:leboncoin
              obj-type: ad-phone-displayed
              check-suite: panda.products.activity_report
              check-name: contact_location_is_available
              check-result: 'true'
              check-impact: blocker
            delta: 1
        - quality.check:
            tags:
              check-group: check-contact-events
              check-type: availability
              provider: sdrn:schibsted:client:leboncoin
              obj-type: ad-phone-displayed
              check-suite: panda.products.activity_report
              check-name: contact_location_address_region_available
              check-result: 'true'
              check-impact: blocker
            delta: 1
        - quality.check:
            tags:
              check-group: check-contact-events
              check-type: availability
              provider: sdrn:schibsted:client:leboncoin
              obj-type: ad-phone-displayed
              check-suite: panda.products.activity_report
              check-name: contact_location_address_locality_available
              check-result: 'true'
              check-impact: blocker
            delta: 1
        - quality.check:
            tags:
              check-group: check-contact-events
              check-type: availability
              provider: sdrn:schibsted:client:leboncoin
              obj-type: ad-phone-displayed
              check-suite: panda.products.activity_report
              check-name: contact_location_postal_code_available
              check-result: 'true'
              check-impact: minor
            delta: 1   
      expression: |
        import "checks/panda/products/activity-report-events-suite.jslt" as p
        let event =
        {
            "@id": "73ae8722-a990-11ea-839d-d6921705fdf2",
            "@type": "Show",
            "actor": {
                "@id": "00000000-0000-4000-8000-000000000000",
                "spt:remoteAddress": "80.215.100.50",
                "spt:userId": "00000000-0000-4000-8000-000000000000"
            },
            "collectorHost": "collector.mpianalytics.com",
            "creationDate": "2020-06-08T14:00:46+00:00",
            "deployStage": "pro",
            "device": {
                "environmentId": "sdrn:schibsted:environment:00000000-0000-4000-8000-000000000000",
                "userAgent": "LBC;Android;10;SM-G970F;phone;41c2164af0c89a8e;wwan;4.55.3.0;95300;0"
            },
            "object": {
                "@id": "sdrn:leboncoin:phonecontact:1770248612",
                "@type": "PhoneContact",
                "inReplyTo": {
                "@id": "sdrn:leboncoin:classified:1770248612",
                "@type": "ClassifiedAd",
                "adId": 1770248612.0,
                "adType": "sell",
                "categories": [
                    {
                    "@type": "MarketplaceCategory",
                    "level": 1.0,
                    "localId": "15",
                    "localName": "informatique",
                    "name": "informatique"
                    },
                    {
                    "@type": "MarketplaceCategory",
                    "level": 0.0,
                    "localId": "15",
                    "localName": "multimedia",
                    "name": "multimedia"
                    }
                ],
                "category": "multimedia > informatique",
                "contentId": "1770248612",
                "currency": "EUR",
                "inLanguage": "French",
                "insertionType": "manual",
                "lastUpdateDate": "2020-04-14T18:58:59+02:00",
                "location": {
                    "@type": "PostalAddress",
                    "addressCountry": "FR",
                    "addressLocality": "Angers",
                    "addressRegion": "pays-de-la-loire > maine-et-loire",
                    "postalCode": "49100"
                },
                "name": "Tablette + drone",
                "price": 55.0,
                "publicationDate": "2020-04-14T18:58:59+02:00",
                "publisher": {
                    "@id": "sdrn:leboncoin:user:1f1b24a5-0f15-4c87-bd6d-b6457b77b424",
                    "@type": "Account",
                    "accountId": "sdrn:leboncoin:user:1f1b24a5-0f15-4c87-bd6d-b6457b77b424",
                    "accountType": "Private",
                    "additionalIds": [
                    {
                        "@id": "sdrn:leboncoin:user:48921031",
                        "component": "leboncoin store id"
                    }
                    ]
                },
                "publisherType": "private",
                "status": "Active",
                "url": "https://www.leboncoin.fr/ad/1770248612.htm",
                "version": 17586030604.0
                }
            },
            "provider": {
                "@id": "sdrn:schibsted:client:leboncoin",
                "@type": "",
                "productTag": "kaas-as-pulse"
            },
            "published": "2020-06-08T14:00:46+00:00",
            "schema": "http://schema.schibsted.com/events/tracker-event.json/177.json#",
            "tracker": {
                "type": "Custom",
                "version": ""
            }
            }
        p($event)
  