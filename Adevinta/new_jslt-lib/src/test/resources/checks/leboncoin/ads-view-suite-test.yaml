tests:

  - name: ads-view-suite.jslt compiles
    type: compile
    expression: |
      import "checks/leboncoin/ads-view-suite.jslt" as f
      f(.)

  - name: ads-view-suite.jslt checks valid ads view event
    expected:
      - quality.check:
          tags:
            check-suite: leboncoin.ads_view
            check-name: event_count
            check-result: 'true'
            check-impact: critical
            platform: android
          delta: 1
      - quality.check:
          tags:
            check-suite: leboncoin.ads_view
            check-name: user_id_completeness
            check-result: 'true'
            check-impact: critical
            platform: android
          delta: 1
      - quality.check:
          tags:
            check-suite: leboncoin.ads_view
            check-name: user_agent_completeness
            check-result: 'true'
            check-impact: critical
            platform: android
          delta: 1
      - quality.check:
          tags:
            check-suite: leboncoin.ads_view
            check-name: referrer_id_completeness
            check-result: 'true'
            check-impact: critical
            platform: android
          delta: 1
      - quality.check:
          tags:
            check-suite: leboncoin.ads_view
            check-name: referrer_type_completeness
            check-result: 'true'
            check-impact: critical
            platform: android
          delta: 1
      - quality.check:
          tags:
            check-suite: leboncoin.ads_view
            check-name: event_id_completeness
            check-result: 'true'
            check-impact: critical
            platform: android
          delta: 1
      - quality.check:
          tags:
            check-suite: leboncoin.ads_view
            check-name: referrer_type_is_in_list
            check-result: 'true'
            check-impact: critical
            platform: android
          delta: 1
      - quality.check:
          tags:
            check-suite: leboncoin.ads_view
            check-name: referrer_id_completeness_if_referrer_type_in_list
            check-result: 'true'
            check-impact: critical
            platform: android
          delta: 1
      - quality.check:
          tags:
            check-suite: leboncoin.ads_view
            check-name: event_id_completeness_if_referrer_type_in_list
            check-result: 'true'
            check-impact: critical
            platform: android
          delta: 1
      - quality.check:
          tags:
            check-suite: leboncoin.ads_view
            check-name: user_id_and_user_agent_completeness
            check-result: 'true'
            check-impact: critical
            platform: android
          delta: 1
    expression: |
      import "checks/leboncoin/ads-view-suite.jslt" as ads-view-checks

      let event =
      {"event_timestamp":1605171763,"event_datetime":"","event_id":"d368a330-24c5-11eb-9d42-5ac0d78aa902","list_id":1875764360,"category":15,"region":21,"store_id":"14727248","user_id":"e5b50f8b-678e-4e7e-b05f-42f3558fc967","remote_addr":"92.184.102.54","user_agent":"LBC;Android;10;MI 8;phone;4b4089afc01cd355;wwan;5.11.2.0;511200;0","referrer_type":"search","referrer_rank":9,"referrer_info":"listing","referrer_id":"b83e9812-24c5-11eb-a439-4ea0003453e9","referrer_page":"listing"}
      ads-view-checks($event)
