tests:

  - name: backend-monitoring-event-suite.jslt generates metrics for a valid image classifier event
    expected:
      - quality.check:
          tags:
            service: v1-classifier
            provider: leboncoin
            check-suite: cognition.backend-monitoring-event
            check-name: event_id_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            service: v1-classifier
            provider: leboncoin
            check-suite: cognition.backend-monitoring-event
            check-name: event_type_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            service: v1-classifier
            provider: leboncoin
            check-suite: cognition.backend-monitoring-event
            check-name: deploy_stage_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            service: v1-classifier
            provider: leboncoin
            check-suite: cognition.backend-monitoring-event
            check-name: request_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            service: v1-classifier
            provider: leboncoin
            check-suite: cognition.backend-monitoring-event
            check-name: response_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            service: v1-classifier
            provider: leboncoin
            check-suite: cognition.backend-monitoring-event
            check-name: provider_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            service: v1-classifier
            provider: leboncoin
            check-suite: cognition.backend-monitoring-event
            check-name: provider_id_valid
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            service: v1-classifier
            provider: leboncoin
            check-suite: cognition.backend-monitoring-event
            check-name: provider_component_service_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            service: v1-classifier
            provider: leboncoin
            check-suite: cognition.backend-monitoring-event
            check-name: request_method_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            service: v1-classifier
            provider: leboncoin
            check-suite: cognition.backend-monitoring-event
            check-name: request_url_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            service: v1-classifier
            provider: leboncoin
            check-suite: cognition.backend-monitoring-event
            check-name: response_recognition_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            service: v1-classifier
            provider: leboncoin
            check-suite: cognition.backend-monitoring-event
            check-name: response_recognition_id_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            service: v1-classifier
            provider: leboncoin
            check-suite: cognition.backend-monitoring-event
            check-name: response_recognition_service_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            service: v1-classifier
            provider: leboncoin
            check-suite: cognition.backend-monitoring-event
            check-name: response_recognition_model_version_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            service: v1-classifier
            provider: leboncoin
            check-suite: cognition.backend-monitoring-event
            check-name: response_predictions_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            service: v1-classifier
            provider: leboncoin
            check-suite: cognition.backend-monitoring-event
            check-name: response_predictions_not_empty
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            service: v1-classifier
            provider: leboncoin
            check-suite: cognition.backend-monitoring-event
            check-name: prediction_attribute_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            service: v1-classifier
            provider: leboncoin
            check-suite: cognition.backend-monitoring-event
            check-name: prediction_attribute_is_valid
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            service: v1-classifier
            provider: leboncoin
            check-suite: cognition.backend-monitoring-event
            check-name: prediction_probability_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            service: v1-classifier
            provider: leboncoin
            check-suite: cognition.backend-monitoring-event
            check-name: prediction_probability_not_negative
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            service: v1-classifier
            provider: leboncoin
            check-suite: cognition.backend-monitoring-event
            check-name: prediction_label_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            service: v1-classifier
            provider: leboncoin
            check-suite: cognition.backend-monitoring-event
            check-name: prediction_type_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            service: v1-classifier
            provider: leboncoin
            check-suite: cognition.backend-monitoring-event
            check-name: prediction_uid_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
    expression: |
      import "checks/cognition/backend-monitoring-event-suite.jslt" as c

      let event =
      {
          "@id": "d3a4b71c-7bd6-4ba1-9784-656f3d7b6c09",
          "@type": "Predict",
          "deployStage": "pre",
          "provider": {
              "@id": "sdrn:schibsted:client:leboncoin",
              "component": "cognition",
              "componentService": "image-classifier"
          },
          "request": {
              "url":"https://img6.leboncoin.fr/ad-large/193e4b2abbdaff397ec0cfb7f4b40cf8e894c4ba.jpg",
              "method":"GET",
              "headers": {
                  "x-cognition-caller": "leboncoin",
                  "x-cognition-tenant": "leboncoin"
              },
              "body": {
                "top_n": "4"
              }
          },
          "response": {
              "recognition": {
                  "@id": "sdrn:leboncoin:recognition:d3a4b71c-7bd6-4ba1-9784-656f3d7b6c09",
                  "service": "v1-classifier",
                  "modelVersion": "1.0.0"
              },
              "predictions": [
                  {
                      "@type": "RecognitionPrediction",
                      "attribute": "category",
                      "label": "Chaussures",
                      "probability": 0.9816532731056213,
                      "uid": "53"
                  },
                  {
                      "@type": "RecognitionPrediction",
                      "attribute": "category",
                      "label": "VÃªtements",
                      "probability": 0.011306445114314556,
                      "uid": "22"
                  },
                  {
                      "@type": "RecognitionPrediction",
                      "attribute": "category",
                      "label": "Accessoires & Bagagerie",
                      "probability": 0.002903976012021303,
                      "uid": "47"
                  },
                  {
                      "@type": "RecognitionPrediction",
                      "attribute": "category",
                      "label": "Collection",
                      "probability": 8.355868048965931E-4,
                      "uid": "40"
                  }
              ]
          },
          "schema": "http://schema.adevinta.com/events/backend-recognition-monitoring-event.json/14.json#"
      }
      c($event)
