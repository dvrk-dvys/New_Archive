tests:
  - name: bic-commons-lead-object.jslt compiles and runs
    type: compile
    expression: |
      import "checks/bic/bic-commons-lead-object.jslt" as c
      c(.)
  - name: bic-commons-lead-object.jslt check-object-id returns false if is null
    expected:
      - quality.check:
          tags:
            check-suite: bic.ad-phone-called
            check-name: object_id_is_not_null
            check-result: 'false'
            check-impact: critical
          delta: 1
    expression: |
      import "checks/bic/bic-commons-lead-object.jslt" as c
      let event =
        {
          "@type": "Call",
          "object": {
            "inReplyTo": {
              "@type": "ClassifiedAd"
            },
            "@type": "PhoneContact",
            "id": null
          }
        }
      c:check-object-id($event, "bic.ad-phone-called", "ad-phone-called", {})
  - name: bic-commons-lead-object.jslt check-object-type returns true if is not null
    expected:
      - quality.check:
          tags:
            check-suite: bic.ad-phone-called
            check-name: object_type_is_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
    expression: |
      import "checks/bic/bic-commons-lead-object.jslt" as c
      let event =
      {
        "@type": "Call",
        "object": {
          "inReplyTo": {
            "@type": "ClassifiedAd"
          },
          "@type": "PhoneContact",
          "id": null
        }
      }
      c:check-object-type($event, "bic.ad-phone-called", "ad-phone-called", {})
  - name: bic-commons-lead-object.jslt check-object-inReplyTo-id returns true if is not null and the correct pattern
    expected:
      - quality.check:
          tags:
            check-suite: bic.ad-phone-called
            check-name: object_inreplyto_id_is_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            check-suite: bic.ad-phone-called
            check-name: object_inreplyto_id_sdrn_pattern
            check-result: 'true'
            check-impact: critical
          delta: 1
    expression: |
      import "checks/bic/bic-commons-lead-object.jslt" as c
      let event =
      {
        "@type": "Call",
        "object": {
          "inReplyTo": {
            "@type": "ClassifiedAd",
            "@id": "sdrn:inventend666:classified:inventedEnd666"
          },
          "@type": "PhoneContact",
          "id": null
        }
      }
      c:check-object-inReplyTo-id($event, "bic.ad-phone-called", "ad-phone-called", {})
  - name: bic-commons-lead-object.jslt check-object-inReplyTo-category returns true if is not null with the correct pattern
    expected:
      - quality.check:
          tags:
            check-suite: bic.ad-phone-called
            check-name: object_inreplyto_category_is_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            check-suite: bic.ad-phone-called
            check-name: object_inreplyto_category_follows_pattern
            check-result: 'true'
            check-impact: critical
          delta: 1
    expression: |
      import "checks/bic/bic-commons-lead-object.jslt" as c
      let event =
      {
        "@type": "Call",
        "object": {
          "inReplyTo": {
            "@type": "ClassifiedAd",
            "category": "category1 > category 2"
          },
          "@type": "PhoneContact",
          "id": null
        }
      }
      c:check-object-inReplyTo-category($event, "bic.ad-phone-called", "ad-phone-called", {})
  - name: bic-commons-lead-object.jslt check-object-inReplyTo-publisherType returns false if is null
    expected:
      - quality.check:
          tags:
            check-suite: bic.ad-phone-called
            check-name: object_inreplyto_publishertype_is_not_null
            check-result: 'false'
            check-impact: critical
          delta: 1
    expression: |
      import "checks/bic/bic-commons-lead-object.jslt" as c
      let event =
      {
        "@type": "Call",
        "object": {
          "inReplyTo": {
            "@type": "ClassifiedAd",
            "publisherType": null
          },
          "@type": "PhoneContact",
          "id": null
        }
      }
      c:check-object-inReplyTo-publisherType($event, "bic.ad-phone-called", "ad-phone-called", {})
  - name: bic-commons-lead-object.jslt check-object-inReplyTo-loc-addloc returns true if is not null
    expected:
      - quality.check:
          tags:
            check-suite: bic.ad-phone-called
            check-name: object_inreplyto_loc_addloc_is_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
    expression: |
      import "checks/bic/bic-commons-lead-object.jslt" as c
      let event =
      {
        "@type": "Call",
        "object": {
          "inReplyTo": {
            "@type": "ClassifiedAd",
            "location": {
              "addressLocality": "locality"
            }
          },
          "@type": "PhoneContact",
          "id": null
        }
      }
      c:check-object-inReplyTo-loc-addloc($event, "bic.ad-phone-called", "ad-phone-called", {})
  - name: bic-commons-lead-object.jslt check-object-inReplyTo-loc-addreg returns true if is not null
    expected:
      - quality.check:
          tags:
            check-suite: bic.ad-phone-called
            check-name: object_inreplyto_loc_addreg_is_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
    expression: |
      import "checks/bic/bic-commons-lead-object.jslt" as c
      let event =
      {
        "@type": "Call",
        "object": {
          "inReplyTo": {
            "@type": "ClassifiedAd",
            "location": {
              "addressRegion": "region"
            }
          },
          "@type": "PhoneContact",
          "id": null
        }
      }
      c:check-object-inReplyTo-loc-addreg($event, "bic.ad-phone-called", "ad-phone-called", {})
  - name: bic-commons-lead-object.jslt check-object-inReplyTo-adtype returns true if is null
    expected:
      - quality.check:
          tags:
            check-suite: bic.ad-phone-called
            check-name: object_inreplyto_adtype_is_not_null
            check-result: 'false'
            check-impact: critical
          delta: 1
    expression: |
      import "checks/bic/bic-commons-lead-object.jslt" as c
      let event =
      {
        "@type": "Call",
        "object": {
          "adType": null,
          "inReplyTo": {
            "@type": "ClassifiedAd",
          },
          "@type": "PhoneContact",
          "id": null
        }
      }
      c:check-object-inReplyTo-adtype($event, "bic.ad-phone-called", "ad-phone-called", {})
  - name: bic-commons-lead-object.jslt check-object-url returns true if is null
    expected:
      - quality.check:
          tags:
            check-suite: bic.ad-phone-called
            check-name: object_url_is_not_null
            check-result: 'false'
            check-impact: critical
          delta: 1
    expression: |
      import "checks/bic/bic-commons-lead-object.jslt" as c
      let event =
      {
        "@type": "Call",
        "object": {
          "url": null,
          "inReplyTo": {
            "@type": "ClassifiedAd",
          },
          "@type": "PhoneContact",
          "id": null
        }
      }
      c:check-object-url($event, "bic.ad-phone-called", "ad-phone-called", {})
  - name: bic-commons-lead-object.jslt check-device-is-bot returns true if is null
    expected:
      - quality.check:
          tags:
            check-suite: bic.ad-phone-called
            check-name: device_is_bot_is_not_null
            check-result: 'false'
            check-impact: critical
          delta: 1
    expression: |
      import "checks/bic/bic-commons-lead-object.jslt" as c
      let event =
      {
        "@type": "Call",
        "object": {
          "device": {
            "isBot": null
          },
          "inReplyTo": {
            "@type": "ClassifiedAd",
          },
          "@type": "PhoneContact",
          "id": null
        }
      }
      c:check-device-is-bot($event, "bic.ad-phone-called", "ad-phone-called", {})