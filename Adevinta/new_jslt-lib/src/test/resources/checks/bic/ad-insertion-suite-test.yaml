tests:
  - name: classified-ad-insertion-suite.jslt generates metrics for a valid event
    expected:
      - quality.check:
          tags:
            product-type: unknown
            event-type: create
            object-type: classifiedad
            device-type: unknown
            tracker: unknown
            check-suite: bic.ad-create
            check-name: count_all
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            product-type: unknown
            event-type: create
            object-type: classifiedad
            device-type: unknown
            tracker: unknown
            check-suite: bic.ad-create
            check-name: suite_is_applied
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            product-type: unknown
            event-type: create
            object-type: classifiedad
            device-type: unknown
            tracker: unknown
            check-suite: bic.ad-create
            check-name: id_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            product-type: unknown
            event-type: create
            object-type: classifiedad
            device-type: unknown
            tracker: unknown
            check-suite: bic.ad-create
            check-name: name_is_not_null
            check-result: 'false'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            product-type: unknown
            event-type: create
            object-type: classifiedad
            device-type: unknown
            tracker: unknown
            check-suite: bic.ad-create
            check-name: type_is_not_null
            check-result: 'true'
            check-impact: blocker
          delta: 1
      - quality.check:
          tags:
            product-type: unknown
            event-type: create
            object-type: classifiedad
            device-type: unknown
            tracker: unknown
            check-suite: bic.ad-create
            check-name: object_id_is_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            product-type: unknown
            event-type: create
            object-type: classifiedad
            device-type: unknown
            tracker: unknown
            check-suite: bic.ad-create
            check-name: object_id_sdrn_pattern
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            product-type: unknown
            event-type: create
            object-type: classifiedad
            device-type: unknown
            tracker: unknown
            check-suite: bic.ad-create
            check-name: object_type_is_not_null
            check-result: 'true'
            check-impact: blocker
          delta: 1
      - quality.check:
          tags:
            product-type: unknown
            event-type: create
            object-type: classifiedad
            device-type: unknown
            tracker: unknown
            check-suite: bic.ad-create
            check-name: object_adtype_is_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            product-type: unknown
            event-type: create
            object-type: classifiedad
            device-type: unknown
            tracker: unknown
            check-suite: bic.ad-create
            check-name: object_category_is_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            product-type: unknown
            event-type: create
            object-type: classifiedad
            device-type: unknown
            tracker: unknown
            check-suite: bic.ad-create
            check-name: object_category_follows_pattern
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            product-type: unknown
            event-type: create
            object-type: classifiedad
            device-type: unknown
            tracker: unknown
            check-suite: bic.ad-create
            check-name: object_loc_addloc_is_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            product-type: unknown
            event-type: create
            object-type: classifiedad
            device-type: unknown
            tracker: unknown
            check-suite: bic.ad-create
            check-name: object_loc_addreg_is_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            product-type: unknown
            event-type: create
            object-type: classifiedad
            device-type: unknown
            tracker: unknown
            check-suite: bic.ad-create
            check-name: object_publishertype_is_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            product-type: unknown
            event-type: create
            object-type: classifiedad
            device-type: unknown
            tracker: unknown
            check-suite: bic.ad-create
            check-name: object_url_is_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            product-type: unknown
            event-type: create
            object-type: classifiedad
            device-type: unknown
            tracker: unknown
            check-suite: bic.ad-create
            check-name: provider_id_is_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            product-type: unknown
            event-type: create
            object-type: classifiedad
            device-type: unknown
            tracker: unknown
            check-suite: bic.ad-create
            check-name: provider_id_sdrn_pattern
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            product-type: unknown
            event-type: create
            object-type: classifiedad
            device-type: unknown
            tracker: unknown
            check-suite: bic.ad-create
            check-name: provider_product_type_is_not_null
            check-result: 'false'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            product-type: unknown
            event-type: create
            object-type: classifiedad
            device-type: unknown
            tracker: unknown
            check-suite: bic.ad-create
            check-name: actor_id_is_not_null
            check-result: 'false'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            product-type: unknown
            event-type: create
            object-type: classifiedad
            device-type: unknown
            tracker: unknown
            check-suite: bic.ad-create
            check-name: origin_url_is_not_null
            check-result: 'false'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            product-type: unknown
            event-type: create
            object-type: classifiedad
            device-type: unknown
            tracker: unknown
            check-suite: bic.ad-create
            check-name: published_is_not_null
            check-result: 'false'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            product-type: unknown
            event-type: create
            object-type: classifiedad
            device-type: unknown
            tracker: unknown
            check-suite: bic.ad-create
            check-name: published_valid_format
            check-result: 'false'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            product-type: unknown
            event-type: create
            object-type: classifiedad
            device-type: unknown
            tracker: unknown
            check-suite: bic.ad-create
            check-name: device_environment_id_not_null
            check-result: 'false'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            product-type: unknown
            event-type: create
            object-type: classifiedad
            device-type: unknown
            tracker: unknown
            check-suite: bic.ad-create
            check-name: device_environment_id_valid_format
            check-result: 'false'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            product-type: unknown
            event-type: create
            object-type: classifiedad
            device-type: unknown
            tracker: unknown
            check-suite: bic.ad-create
            check-name: device_jwe_ids_not_null_and_not_empty
            check-result: 'false'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            product-type: unknown
            event-type: create
            object-type: classifiedad
            device-type: unknown
            tracker: unknown
            check-suite: bic.ad-create
            check-name: device_device_type_not_null_and_not_empty
            check-result: 'false'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            product-type: unknown
            event-type: create
            object-type: classifiedad
            device-type: unknown
            tracker: unknown
            check-suite: bic.ad-create
            check-name: tracker_type_not_null_and_not_empty
            check-result: 'false'
            check-impact: critical
          delta: 1
    expression: |
      import "checks/bic/ad-insertion-suite.jslt" as c

      let event =
        {
            "@id": "2a3e79df-62e0-49c9-af9f-f3be11fa356f",
            "@type": "Create",
            "eventTime": "2019-04-25T12:34:14.1050Z",
            "object": {
                "@id": "sdrn:finn:classified:93899363",
                "@type": "ClassifiedAd",
                "adType": "sell",
                "category": "BAP > SALESOBJECT > antiques > antiques_other",
                "currency": "NOK",
                "description": "Gammelt trau. 70x35",
                "images": [
                    "https://images.finncdn.no/mmo/2017/4/vertical-5/04/3/938/993/63_1033926475.jpg",
                    "https://images.finncdn.no/mmo/2017/4/vertical-5/04/3/938/993/63_158701161.jpg",
                    "https://images.finncdn.no/mmo/2017/4/vertical-5/04/3/938/993/63_845741415.jpg",
                    "https://images.finncdn.no/mmo/2017/4/vertical-5/04/3/938/993/63_846497983.jpg"
                ],
                "items": [
                    {
                        "@type": "MarketplaceItem"
                    }
                ],
                "location": {
                    "@type": "PostalAddress",
                    "addressCountry": "Norway",
                    "addressLocality": "Våler i Solør",
                    "postalCode": "2436",
                    "streetAddress": "KNATTEN 2",
                    "addressRegion": "centre"
                },
                "name": "Trau",
                "price": 400,
                "publisher": {
                    "@id": "sdrn:finn:user:1124573572",
                    "name": "helge susort"
                },
                "publisherType": "private",
                "status": "pending first publication",
                "url": "https://www.finn.no/bap/webstore/ad.html?finnkode=93899363"
            },
            "provider": {
                "@id": "sdrn:schibsted:client:finn",
                "@type": "Organization"
            },
            "schema": "https://schema.adevinta.com/events/backend-content-event.json/79.json#"
        }
      c($event)
