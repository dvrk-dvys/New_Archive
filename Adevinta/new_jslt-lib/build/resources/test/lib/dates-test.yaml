tests:

  - name: dates.jslt compiles
    type: compile
    expression: |
      import "lib/dates.jslt" as d
      d(.)

  - name: string-to-date should parse date
    expected: "2020-06-20T14:55:09Z"
    expression: |
      import "lib/dates.jslt" as d
      let a = d:string-to-date("2020-06-20T14:55:09Z")

      format-time($a, "yyyy-MM-dd'T'HH:mm:ssX")

  - name: string-to-date should parse date with millis
    expected: "2020-06-20T14:55:09.350Z"
    expression: |
      import "lib/dates.jslt" as d
      let a = d:string-to-date("2020-06-20T14:55:09.350Z")

      format-time($a, "yyyy-MM-dd'T'HH:mm:ss.SSSX")

  - name: string-to-date should return null when invalid date
    expected: null
    expression: |
      import "lib/dates.jslt" as d
      d:string-to-date("hello")

  - name: check-date-diff-to-now
    expected: true
    expression: |
      import "lib/dates.jslt" as d
      let seconds_per_hour = 3600
      let threshold = 2 * $seconds_per_hour
      let a = now() - $seconds_per_hour

      d:check-date-diff-to-now($a, $threshold)

  - name: check-date-diff-to-now should return false when time difference is greater to max_latency_in_hours
    expected: false
    expression: |
      import "lib/dates.jslt" as d
      let seconds_per_hour = 3600
      let threshold = 2 * $seconds_per_hour
      let a = now() - ($seconds_per_hour * 3)

      d:check-date-diff-to-now($a, $threshold)

  - name: check-date-diff-to-now should return false when null date
    expected: false
    expression: |
      import "lib/dates.jslt" as d

      d:check-date-diff-to-now(null, 1)

  - name: dates.jslt check-date-diff method
    expected: true
    expression: |
      import "lib/dates.jslt" as d

      let ten-min-in-seconds = 10 * 60
      let date1 = now()
      d:check-date-diff($date1, $date1 + $ten-min-in-seconds - 1, $ten-min-in-seconds) and
      d:check-date-diff($date1, $date1 + $ten-min-in-seconds + 1, $ten-min-in-seconds) == false and
      d:check-date-diff($date1 + $ten-min-in-seconds - 1, $date1, $ten-min-in-seconds) and
      d:check-date-diff($date1 + $ten-min-in-seconds + 1, $date1, $ten-min-in-seconds) == false
