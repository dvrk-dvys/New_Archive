tests:

  - name: smartbump-events-suite.jslt compiles
    type: compile
    expression: |
      import "checks/panda/products/smartbump-events-suite.jslt" as p
      p(.)

  - name: smartbump-events-suite.jslt generates metrics for a valid ad-delete events
    expected:
      - quality.check:
          tags:
            check-group: check-generic-fields
            check-type: availability
            provider: sdrn:schibsted:client:leboncoin
            obj-type: ad-deletion
            check-suite: panda.products.smartbump
            check-name: domain_is_available
            check-result: 'true'
            check-impact: blocker
          delta: 1
      - quality.check:
          tags:
            check-group: check-generic-fields
            check-type: validity
            provider: sdrn:schibsted:client:leboncoin
            obj-type: ad-deletion
            check-suite: panda.products.smartbump
            check-name: domain_is_valid
            check-result: 'true'
            check-impact: blocker
          delta: 1
      - quality.check:
          tags:
            check-group: check-generic-fields
            check-type: availability
            provider: sdrn:schibsted:client:leboncoin
            obj-type: ad-deletion
            check-suite: panda.products.smartbump
            check-name: visitor_ip_available
            check-result: 'false'
            check-impact: blocker
          delta: 1
      - quality.check:
          tags:
            check-group: check-generic-fields
            check-type: validity
            provider: sdrn:schibsted:client:leboncoin
            obj-type: ad-deletion
            check-suite: panda.products.smartbump
            check-name: visitor_ip_valid
            check-result: 'false'
            check-impact: blocker
          delta: 1
      - quality.check:
          tags:
            check-group: check-generic-fields
            check-type: availability
            provider: sdrn:schibsted:client:leboncoin
            obj-type: ad-deletion
            check-suite: panda.products.smartbump
            check-name: creation_date_available
            check-result: 'true'
            check-impact: blocker
          delta: 1
      - quality.check:
          tags:
            check-group: check-generic-fields
            check-type: validity
            provider: sdrn:schibsted:client:leboncoin
            obj-type: ad-deletion
            check-suite: panda.products.smartbump
            check-name: creation_date_valid
            check-result: 'true'
            check-impact: blocker
          delta: 1
      - quality.check:
          tags:
            check-group: check-classified-ad-events
            check-type: availability
            provider: sdrn:schibsted:client:leboncoin
            obj-type: ad-deletion
            check-suite: panda.products.smartbump
            check-name: object_id_is_available
            check-result: 'true'
            check-impact: blocker
          delta: 1
      - quality.check:
          tags:
            check-group: check-classified-ad-events
            check-type: validity
            provider: sdrn:schibsted:client:leboncoin
            obj-type: ad-deletion
            check-suite: panda.products.smartbump
            check-name: object_id_is_valid
            check-result: 'true'
            check-impact: blocker
          delta: 1
      - quality.check:
          tags:
            check-group: check-classified-ad-events
            check-type: availability
            provider: sdrn:schibsted:client:leboncoin
            obj-type: ad-deletion
            check-suite: panda.products.smartbump
            check-name: publisher_is_available
            check-result: 'true'
            check-impact: blocker
          delta: 1
      - quality.check:
          tags:
            check-group: check-classified-ad-events
            check-type: availability
            provider: sdrn:schibsted:client:leboncoin
            obj-type: ad-deletion
            check-suite: panda.products.smartbump
            check-name: publisher_id_is_available
            check-result: 'true'
            check-impact: blocker
          delta: 1
      - quality.check:
          tags:
            check-group: check-classified-ad-events
            check-type: validity
            provider: sdrn:schibsted:client:leboncoin
            obj-type: ad-deletion
            check-suite: panda.products.smartbump
            check-name: publisher_id_is_valid
            check-result: 'true'
            check-impact: blocker
          delta: 1
      - quality.check:
          tags:
            check-group: check-classified-ad-events
            check-type: availability
            provider: sdrn:schibsted:client:leboncoin
            obj-type: ad-deletion
            check-suite: panda.products.smartbump
            check-name: categories_are_available
            check-result: 'true'
            check-impact: blocker
          delta: 1
      - quality.check:
          tags:
            check-group: check-classified-ad-events
            check-type: availability
            provider: sdrn:schibsted:client:leboncoin
            obj-type: ad-deletion
            check-suite: panda.products.smartbump
            check-name: categories_local_ids_available
            check-result: 'true'
            check-impact: blocker
          delta: 1
      - quality.check:
          tags:
            check-group: check-classified-ad-events
            check-type: availability
            provider: sdrn:schibsted:client:leboncoin
            obj-type: ad-deletion
            check-suite: panda.products.smartbump
            check-name: categories_levels_are_available
            check-result: 'true'
            check-impact: blocker
          delta: 1
      - quality.check:
          tags:
            check-group: check-classified-ad-events
            check-type: validity
            provider: sdrn:schibsted:client:leboncoin
            obj-type: ad-deletion
            check-suite: panda.products.smartbump
            check-name: categories_levels_are_valid
            check-result: 'false'
            check-impact: blocker
          delta: 1
      - quality.check:
          tags:
            check-group: check-classified-ad-events
            check-type: availability
            provider: sdrn:schibsted:client:leboncoin
            obj-type: ad-deletion
            check-suite: panda.products.smartbump
            check-name: location_is_available
            check-result: 'true'
            check-impact: blocker
          delta: 1
      - quality.check:
          tags:
            check-group: check-classified-ad-events
            check-type: availability
            provider: sdrn:schibsted:client:leboncoin
            obj-type: ad-deletion
            check-suite: panda.products.smartbump
            check-name: location_address_region_available
            check-result: 'true'
            check-impact: blocker
          delta: 1
      - quality.check:
          tags:
            check-group: check-classified-ad-events
            check-type: availability
            provider: sdrn:schibsted:client:leboncoin
            obj-type: ad-deletion
            check-suite: panda.products.smartbump
            check-name: location_address_locality_available
            check-result: 'true'
            check-impact: blocker
          delta: 1
      - quality.check:
          tags:
            check-group: check-classified-ad-events
            check-type: availability
            provider: sdrn:schibsted:client:leboncoin
            obj-type: ad-deletion
            check-suite: panda.products.smartbump
            check-name: location_postal_code_available
            check-result: 'true'
            check-impact: minor
          delta: 1
      - quality.check:
          tags:
            check-group: check-classified-ad-events
            check-type: availability
            provider: sdrn:schibsted:client:leboncoin
            obj-type: ad-deletion
            check-suite: panda.products.smartbump
            check-name: version_is_available
            check-result: 'true'
            check-impact: minor
          delta: 1
      - quality.check:
          tags:
            check-group: check-classified-ad-events
            check-type: validity
            provider: sdrn:schibsted:client:leboncoin
            obj-type: ad-deletion
            check-suite: panda.products.smartbump
            check-name: version_is_valid
            check-result: 'false'
            check-impact: minor
          delta: 1
    expression: |
      import "checks/panda/products/smartbump-events-suite.jslt" as p
      let event =
      {
        "@id": "f99bb4e8-26c6-4434-a096-3482f267c890",
        "@type": "Delete",
        "actor": {
          "@id": "00000000-0000-4000-8000-000000000000",
          "additionalIds": [
            {
              "@id": "sdrn:leboncoin:user:49999441",
              "component": "leboncoin store id"
            }
          ],
          "spt:userId": "00000000-0000-4000-8000-000000000000"
        },
        "collectorHost": "collector.mpianalytics.com",
        "creationDate": "2020-06-08T14:04:51Z",
        "deployStage": "pro",
        "device": {
          "environmentId": "sdrn:schibsted:environment:00000000-0000-4000-8000-000000000000"
        },
        "object": {
          "@id": "sdrn:leboncoin:classified:1795242436",
          "@type": "ClassifiedAd",
          "adId": 1795242436.0,
          "adParams": [
            {
              "name": "geoip_country",
              "value": "FR"
            },
            {
              "name": "geo_provider",
              "value": "here"
            },
            {
              "name": "siren",
              "value": "877710798"
            },
            {
              "name": "geo_source",
              "value": "city"
            }
          ],
          "adType": "sell",
          "categories": [
            {
              "@type": "MarketplaceCategory",
              "level": 1.0,
              "localId": "34",
              "localName": "prestations_services",
              "name": "prestations_services"
            },
            {
              "@type": "MarketplaceCategory",
              "level": 0.0,
              "localId": "34",
              "localName": "services",
              "name": "services"
            }
          ],
          "category": "services > prestations_services",
          "contentId": "1795242436",
          "currency": "EUR",
          "description": "Hello,\n\nJe suis un professionnel du Design, je suis sp\u00e9cialis\u00e9 dans la cr\u00e9ation de LOGO, passionn\u00e9 par mon m\u00e9tier je vous propose de vous cr\u00e9ez un logo professionnel et sans comparaison avec ce que vous pouvez trouvez sur Internet !\n\nVous pouvez me contacter par t\u00e9l\u00e9phone au  0754120201\n\nPaiement par ch\u00e8que, virement, ou esp\u00e8ce, en plusieurs fois possible.\n\nA tout de suite !",
          "inLanguage": "French",
          "insertionType": "manual",
          "lastUpdateDate": "2020-06-08T13:20:16+02:00",
          "location": {
            "@type": "PostalAddress",
            "addressCountry": "FR",
            "addressLocality": "Metz",
            "addressRegion": "lorraine > moselle",
            "postalCode": "57000"
          },
          "name": "Besoin d'un LOGO PRO ?",
          "price": 150.0,
          "publicationDate": "2020-06-08T13:20:16+02:00",
          "publisher": {
            "@id": "sdrn:leboncoin:user:e35442ea-df20-47a5-929d-d9a2de16f076",
            "@type": "Account",
            "accountId": "sdrn:leboncoin:user:e35442ea-df20-47a5-929d-d9a2de16f076",
            "accountType": "Professional",
            "additionalIds": [
              {
                "@id": "sdrn:leboncoin:user:49999441",
                "component": "leboncoin store id"
              }
            ]
          },
          "publisherType": "pro",
          "status": "Inactive",
          "url": "https://www.leboncoin.fr/ad/1795242436.htm",
          "version": "17600673087.000000"
        },
        "provider": {
          "@id": "sdrn:schibsted:client:leboncoin",
          "@type": "",
          "productTag": "kaas-as-pulse"
        },
        "published": "2020-06-08T14:04:51Z",
        "schema": "http://schema.schibsted.com/events/tracker-event.json/177.json#",
        "tracker": {
          "type": "Custom",
          "version": ""
        }
      }
      p($event)
