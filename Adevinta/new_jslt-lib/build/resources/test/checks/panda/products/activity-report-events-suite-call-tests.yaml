tests:

    - name: activity-report-events-suite.jslt compiles
      type: compile
      expression: |
        import "checks/panda/products/activity-report-events-suite.jslt" as p
        p(.)
  
    - name: activity-report-events-suite.jslt generates metrics for a valid ad-call events
      expected:
        - quality.check:
            tags:
              check-group: check-generic-fields
              check-type: availability
              provider: sdrn:schibsted:client:willhabenat
              obj-type: ad-phone-called
              check-suite: panda.products.activity_report
              check-name: domain_is_available
              check-result: 'true'
              check-impact: blocker
            delta: 1
        - quality.check:
            tags:
              check-group: check-generic-fields
              check-type: validity
              provider: sdrn:schibsted:client:willhabenat
              obj-type: ad-phone-called
              check-suite: panda.products.activity_report
              check-name: domain_is_valid
              check-result: 'true'
              check-impact: blocker
            delta: 1
        - quality.check:
            tags:
              check-group: check-generic-fields
              check-type: availability
              provider: sdrn:schibsted:client:willhabenat
              obj-type: ad-phone-called
              check-suite: panda.products.activity_report
              check-name: visitor_ip_available
              check-result: 'true'
              check-impact: blocker
            delta: 1
        - quality.check:
            tags:
              check-group: check-generic-fields
              check-type: validity
              provider: sdrn:schibsted:client:willhabenat
              obj-type: ad-phone-called
              check-suite: panda.products.activity_report
              check-name: visitor_ip_valid
              check-result: 'true'
              check-impact: blocker
            delta: 1
        - quality.check:
            tags:
              check-group: check-generic-fields
              check-type: availability
              provider: sdrn:schibsted:client:willhabenat
              obj-type: ad-phone-called
              check-suite: panda.products.activity_report
              check-name: creation_date_available
              check-result: 'true'
              check-impact: blocker
            delta: 1
        - quality.check:
            tags:
              check-group: check-generic-fields
              check-type: validity
              provider: sdrn:schibsted:client:willhabenat
              obj-type: ad-phone-called
              check-suite: panda.products.activity_report
              check-name: creation_date_valid
              check-result: 'true'
              check-impact: blocker
            delta: 1
        - quality.check:
            tags:
              check-group: check-contact-events
              check-type: availability
              provider: sdrn:schibsted:client:willhabenat
              obj-type: ad-phone-called
              check-suite: panda.products.activity_report
              check-name: contact_object_id_is_available
              check-result: 'true'
              check-impact: blocker
            delta: 1
        - quality.check:
            tags:
              check-group: check-contact-events
              check-type: validity
              provider: sdrn:schibsted:client:willhabenat
              obj-type: ad-phone-called
              check-suite: panda.products.activity_report
              check-name: contact_object_id_is_valid
              check-result: 'true'
              check-impact: blocker
            delta: 1
        - quality.check:
            tags:
              check-group: check-contact-events
              check-type: availability
              provider: sdrn:schibsted:client:willhabenat
              obj-type: ad-phone-called
              check-suite: panda.products.activity_report
              check-name: contact_publisher_is_available
              check-result: 'true'
              check-impact: blocker
            delta: 1
        - quality.check:
            tags:
              check-group: check-contact-events
              check-type: availability
              provider: sdrn:schibsted:client:willhabenat
              obj-type: ad-phone-called
              check-suite: panda.products.activity_report
              check-name: contact_publisher_id_is_available
              check-result: 'true'
              check-impact: blocker
            delta: 1
        - quality.check:
            tags:
              check-group: check-contact-events
              check-type: validity
              provider: sdrn:schibsted:client:willhabenat
              obj-type: ad-phone-called
              check-suite: panda.products.activity_report
              check-name: contact_publisher_id_is_valid
              check-result: 'true'
              check-impact: blocker
            delta: 1
        - quality.check:
            tags:
              check-group: check-contact-events
              check-type: availability
              provider: sdrn:schibsted:client:willhabenat
              obj-type: ad-phone-called
              check-suite: panda.products.activity_report
              check-name: contact_categories_are_available
              check-result: 'true'
              check-impact: blocker
            delta: 1
        - quality.check:
            tags:
              check-group: check-contact-events
              check-type: availability
              provider: sdrn:schibsted:client:willhabenat
              obj-type: ad-phone-called
              check-suite: panda.products.activity_report
              check-name: contact_categories_local_ids_available
              check-result: 'true'
              check-impact: blocker
            delta: 1
        - quality.check:
            tags:
              check-group: check-contact-events
              check-type: availability
              provider: sdrn:schibsted:client:willhabenat
              obj-type: ad-phone-called
              check-suite: panda.products.activity_report
              check-name: contact_categories_levels_are_available
              check-result: 'true'
              check-impact: blocker
            delta: 1
        - quality.check:
            tags:
              check-group: check-contact-events
              check-type: validity
              provider: sdrn:schibsted:client:willhabenat
              obj-type: ad-phone-called
              check-suite: panda.products.activity_report
              check-name: contact_categories_levels_are_valid
              check-result: 'false'
              check-impact: blocker
            delta: 1
        - quality.check:
            tags:
              check-group: check-contact-events
              check-type: availability
              provider: sdrn:schibsted:client:willhabenat
              obj-type: ad-phone-called
              check-suite: panda.products.activity_report
              check-name: contact_location_is_available
              check-result: 'true'
              check-impact: blocker
            delta: 1
        - quality.check:
            tags:
              check-group: check-contact-events
              check-type: availability
              provider: sdrn:schibsted:client:willhabenat
              obj-type: ad-phone-called
              check-suite: panda.products.activity_report
              check-name: contact_location_address_region_available
              check-result: 'true'
              check-impact: blocker
            delta: 1
        - quality.check:
            tags:
              check-group: check-contact-events
              check-type: availability
              provider: sdrn:schibsted:client:willhabenat
              obj-type: ad-phone-called
              check-suite: panda.products.activity_report
              check-name: contact_location_address_locality_available
              check-result: 'true'
              check-impact: blocker
            delta: 1
        - quality.check:
            tags:
              check-group: check-contact-events
              check-type: availability
              provider: sdrn:schibsted:client:willhabenat
              obj-type: ad-phone-called
              check-suite: panda.products.activity_report
              check-name: contact_location_postal_code_available
              check-result: 'true'
              check-impact: minor
            delta: 1
      expression: |
        import "checks/panda/products/activity-report-events-suite.jslt" as p
        let event =
        {
            "@id": "5860ea1f-298b-47c1-912e-c04ecdfe01d2",
            "@type": "Call",
            "actor": {
              "@id": "00000000-0000-4000-8000-000000000000",
              "spt:remoteAddress": "80.110.103.241",
              "spt:userId": "00000000-0000-4000-8000-000000000000"
            },
            "collectorHost": "collector.mpianalytics.com",
            "creationDate": "2020-06-04T14:08:46.358Z",
            "device": {
              "@type": "Device",
              "deviceType": "mobile",
              "environmentId": "sdrn:schibsted:environment:cefe1235-5798-44ef-9029-3945bab68a6e",
              "hardware": "mt6739",
              "jweIds": "eyJpc3N1ZWRBdCI6IjIwMjAtMDEtMTlUMTQ6MTU6NTNaIiwiZW5jIjoiQTEyOENCQy1IUzI1NiIsImFsZyI6ImRpciIsImtpZCI6IjIifQ..-WmpiwgYKv0EHrtzVoCN2g.dJTfJ-9xwt0LZIbGu6jsfsOqLl0Nl2V4Gb0cBGRjxI-OMAndF7sVAALzjvlrvUd3ZSZl26lQmZWa5GM5aUhpDoG1cFHzgc2cvAYA-I1sDfZrMNEYpyglmfzlJElYKGcYt-3S9fGX8PgQI03-1JDGDBogFs3Lr-rUu2tXxS5sXGKi2BTfiBZKoKSP_4EBHozgXyNU2Z58a3elXLHlZp9gSUM1GVS865Sagnk6jbJGzCJ8z3-WWkcGX4801t2mYTsb.s261ecTbFQ_fUgHmcdGr-A",
              "manufacturer": "UMIDIGI",
              "model": "A3_Pro",
              "networkConnectivity": {
                "@type": "NetworkConnectivity",
                "networks": [
                  {
                    "networkState": "connected",
                    "networkType": "wifi"
                  }
                ]
              },
              "osType": "Android",
              "osVersion": "9",
              "product": "A3_Pro",
              "release": "9",
              "screenSize": "720x1332",
              "sdkVersion": "28",
              "userAgent": "Android-Pulse-Tracker/7.5.1"
            },
            "name": "Ad phone number called",
            "object": {
              "@type": "PhoneContact",
              "inReplyTo": {
                "@id": "sdrn:willhabenat:classified:385169459",
                "@type": "ClassifiedAd",
                "adId": 385169459.0,
                "adType": "let",
                "categories": [
                  {
                    "@type": "MarketplaceCategory",
                    "level": 1.0,
                    "localId": "sdrn:willhabenat:category:realestate:7276",
                    "localName": "Wohnung",
                    "name": "Wohnung"
                  },
                  {
                    "@type": "MarketplaceCategory",
                    "level": 0.0,
                    "localId": "sdrn:willhabenat:category:realestate:7274",
                    "localName": "RealEstate",
                    "name": "RealEstate"
                  }
                ],
                "category": "RealEstate > Wohnung",
                "contentId": "385169459",
                "currency": "EUR",
                "location": {
                  "@type": "PostalAddress",
                  "addressCountry": "AT",
                  "addressLocality": "Wien, 12. Bezirk, Meidling",
                  "addressRegion": "Wien",
                  "postalCode": "1120"
                },
                "name": "Gemeindewohnung mit Vormerkschein (bitte nur Anrufe)",
                "price": 680.0,
                "publisher": {
                  "@id": "sdrn:iad.willhaben.at:user:d1785c75-6453-425b-b313-c82a3667e9e5",
                  "@type": "Account"
                },
                "publisherType": "private"
              },
              "name": "Lilli Gasteiner"
            },
            "provider": {
              "@id": "sdrn:schibsted:client:willhabenat",
              "@type": "Provider",
              "product": "at.willhaben:269021:willhaben",
              "productType": "AndroidApp"
            },
            "published": "2020-06-04T14:09:55+00:00",
            "schema": "http://schema.schibsted.com/events/tracker-event.json/168.json",
            "tracker": {
              "name": "Android Pulse Tracker",
              "trash": "{\"@type\":\"Tracker\"}",
              "type": "Android",
              "version": "7.5.1-22"
            }
          }          
        p($event)
  