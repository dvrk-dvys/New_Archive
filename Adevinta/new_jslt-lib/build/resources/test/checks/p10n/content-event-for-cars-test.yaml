tests:

  - name: content-events-for-cars.jslt compiles
    type: compile
    expression: |
      import "checks/p10n/content-events-for-cars.jslt" as c
      c(.)

  - name: content-events-for-cars.jslt generates metrics for valid car content event
    expected:
      - quality.check:
          tags:
            event-type: publish
            check-suite: p10n.content-event
            check-name: count_by_eventtype
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            event-type: publish
            check-suite: p10n.content-event
            check-name: event_id_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1  
      - quality.check:
          tags:
            event-type: publish
            check-suite: p10n.content-event
            check-name: provider_id_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            event-type: publish
            check-suite: p10n.content-event
            check-name: object_id_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            event-type: publish
            check-suite: p10n.content-event
            check-name: object_type_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            event-type: publish
            check-suite: p10n.content-event
            check-name: object_adtype_not_null
            check-result: 'true'
            check-impact: minor
          delta: 1
      - quality.check:
          tags:
            event-type: publish
            check-suite: p10n.content-event
            check-name: object_category_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            event-type: publish
            check-suite: p10n.content-event
            check-name: object_location_address_locality_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            event-type: publish
            check-suite: p10n.content-event
            check-name: object_location_address_region_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            event-type: publish
            check-suite: p10n.content-event
            check-name: object_price_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            event-type: publish
            check-suite: p10n.content-event
            check-name: object_publisher_type_not_null
            check-result: 'true'
            check-impact: minor
          delta: 1
      - quality.check:
          tags:
            event-type: publish
            check-suite: p10n.content-event
            check-name: object_publisher_id_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            event-type: publish
            check-suite: p10n.content-event
            check-name: object_publication_date_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            event-type: publish
            check-suite: p10n.content-event
            check-name: object_status_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            event-type: publish
            check-suite: p10n.content-event
            check-name: object_currency_not_null
            check-result: 'true'
            check-impact: minor
          delta: 1
      - quality.check:
          tags:
            event-type: publish
            check-suite: p10n.content-event
            check-name: object_name_not_null
            check-result: 'false'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            event-type: publish
            check-suite: p10n.content-event
            check-name: object_description_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            event-type: publish
            check-suite: p10n.content-event
            check-name: event_time_valid_format
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            event-type: publish
            check-suite: p10n.content-event
            check-name: deploy_stage_valid_value
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            event-type: publish
            check-suite: p10n.content-event
            check-name: object_id_valid_format
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            event-type: publish
            check-suite: p10n.content-event
            check-name: object_publisher_id_valid_format
            check-result: 'true'
            check-impact: minor
          delta: 1
      - quality.check:
          tags:
            event-type: publish
            check-suite: p10n.content-event
            check-name: object_price_valid_format
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            event-type: publish
            check-suite: p10n.content-event
            check-name: object_category_valid_format
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            event-type: publish
            check-suite: p10n.content-event
            check-name: object_location_address_region_valid_format
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            event-type: publish
            check-suite: p10n.content-event
            check-name: object_location_address_locality_valid_format
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            event-type: publish
            check-suite: p10n.content-event
            check-name: object_publisher_type_valid_value
            check-result: 'true'
            check-impact: minor
          delta: 1
      - quality.check:
          tags:
            event-type: publish
            check-suite: p10n.content-event
            check-name: object_ad_type_valid_value
            check-result: 'true'
            check-impact: minor
          delta: 1
      - quality.check:
          tags:
            event-type: publish
            check-suite: p10n.content-event
            check-name: object_status_valid_value
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            event-type: publish
            check-suite: p10n.content-event
            check-name: car_manufacturer_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            event-type: publish
            check-suite: p10n.content-event
            check-name: car_mileage_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            event-type: publish
            check-suite: p10n.content-event
            check-name: car_model_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            event-type: publish
            check-suite: p10n.content-event
            check-name: car_registration_year_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            event-type: publish
            check-suite: p10n.content-event
            check-name: car_fuel_type_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            event-type: publish
            check-suite: p10n.content-event
            check-name: car_vehicle_transmission_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            event-type: publish
            check-suite: p10n.content-event
            check-name: car_color_not_null
            check-result: 'true'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            event-type: publish
            check-suite: p10n.content-event
            check-name: car_engine_volume_not_null
            check-result: 'false'
            check-impact: critical
          delta: 1
      - quality.check:
          tags:
            event-type: publish
            check-suite: p10n.content-event
            check-name: car_engine_volume_unit_not_null
            check-result: 'true'
            check-impact: minor
          delta: 1
      - quality.check:
          tags:
            event-type: publish
            check-suite: p10n.content-event
            check-name: car_drive_wheels_not_null
            check-result: 'false'
            check-impact: minor
          delta: 1
      - quality.check:
          tags:
            event-type: publish
            check-suite: p10n.content-event
            check-name: car_number_of_doors_not_null
            check-result: 'true'
            check-impact: minor
          delta: 1

    expression: |
      import "checks/p10n/content-events-for-cars.jslt" as c
      let contentEvent =
      {
          "@id": "75dc5638-663f-4b5c-ad75-a27872bf9dee",
          "@type": "Publish",
          "collectorHost": "collector.mpianalytics.com",
          "deployStage": "pro",
          "eventTime": "2020-06-02T12:22:00Z",
          "object": {
              "@id": "sdrn:milanuncios:classified:329903",
              "@type": "ClassifiedAd",
              "adId": 329903,
              "adType": "sell",
              "category": "Renault",
              "currency": "EUR",
              "description": "(puede ver todos nuestros vehiculos en nuestra web\n\n(maÑanas con cita previa, tardes de 16 a 20 horas)\nse entrega (limpio y desinfectado)\n",
              "items": [
                  {
                      "color": "Gris / Plata",
                      "engineVolumeUnit": "cc",
                      "fuelType": "diesel",
                      "manufacturer": "RENAULT",
                      "mileage": 300000,
                      "model": "Megane GRAND TOUR CONFORT EXPRESSION 1.5DCI105",
                      "numberOfDoors": 5,
                      "registrationYear": 2006,
                      "vehicleTransmission": "manual"
                  }
              ],
              "location": {
                  "@type": "PostalAddress",
                  "addressCountry": "España",
                  "addressRegion": "Pa",
                  "addressLocality": "galdakao/galdacano/galdakano"
              },
              "price": 1790.0,
              "publicationDate": "2020-06-02T12:22:00Z",
              "publisher": {
                  "@id": "sdrn:milanuncios:user:19091"
              },
              "publisherType": "pro",
              "status": "active",
              "title": "ClassifiedAd"
          },
          "provider": {
              "@id": "sdrn:schibsted:client:milanuncios",
              "@type": "Organization"
          },
          "schema": "http://schema.adevinta.com/events/backend-content-event.json/159.json"
      }
      c($contentEvent)

