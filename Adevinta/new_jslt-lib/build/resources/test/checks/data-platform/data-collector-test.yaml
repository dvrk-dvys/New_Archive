tests:

  - name: data-collector-suite.jslt compiles
    type: compile
    expression: |
      import "checks/data-platform/data-collector-suite.jslt" as collector-checks
      collector-checks(.)

  - name: data-collector-suite.jslt generates metrics for a valid event
    expected:
      - quality.check:
          tags:
            event-type: view
            object-type: classifiedad
            tracker: android
            check-suite: data_platform.data_collector
            check-name: provider_id_not_null
            check-result: "true"
            check-impact: blocker
          delta: 1
      - quality.check:
          tags:
            event-type: view
            object-type: classifiedad
            tracker: android
            check-suite: data_platform.data_collector
            check-name: schema_url_valid
            check-result: "true"
            check-impact: blocker
          delta: 1
      - quality.check:
          tags:
            event-type: view
            object-type: classifiedad
            tracker: android
            check-suite: data_platform.data_collector
            check-name: deploystage_valid
            check-result: "true"
            check-impact: blocker
          delta: 1
    expression: |
      import "checks/data-platform/data-collector-suite.jslt" as collector-checks

      let event =
      {
        "@type": "View",
        "object": {
          "@type": "ClassifiedAd"
        },
        "tracker": {
          "type": "Android"
        },
        "provider": {
          "_AT_id": "sdrn:schibsted:client:blocket",
        },
        "schema": "http://schema.adevinta.com/events/tracker-event.json/237.json#",
      }
      collector-checks($event)

  - name: data-collector-suite.jslt generates metrics with check-result false for a invalid event
    expected:
      - quality.check:
          tags:
            event-type: view
            object-type: classifiedad
            tracker: android
            check-suite: data_platform.data_collector
            check-name: provider_id_not_null
            check-result: "false"
            check-impact: blocker
          delta: 1
      - quality.check:
          tags:
            event-type: view
            object-type: classifiedad
            tracker: android
            check-suite: data_platform.data_collector
            check-name: schema_url_valid
            check-result: "false"
            check-impact: blocker
          delta: 1
      - quality.check:
          tags:
            event-type: view
            object-type: classifiedad
            tracker: android
            check-suite: data_platform.data_collector
            check-name: deploystage_valid
            check-result: "false"
            check-impact: blocker
          delta: 1
    expression: |
      import "checks/data-platform/data-collector-suite.jslt" as collector-checks

      let event =
      {
        "@type": "View",
        "object": {
          "@type": "ClassifiedAd"
        },
        "tracker": {
          "type": "Android"
        },
        "schema": "http://schema.adevinta.ES/events/tracker-event.json/237.json#",
        "deployStage": "PRODUCTION"
      }
      collector-checks($event)
